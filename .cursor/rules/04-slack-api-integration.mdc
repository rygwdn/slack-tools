---
description: Guidelines for interacting with the Slack API
globs: ["**/slack/**/*.ts", "**/api/**/*.ts"]
alwaysApply: false
---
# Slack API Integration Guidelines

## Authentication and Token Management

### Overview
- Authentication is managed through [src/auth.ts](mdc:src/auth.ts)
- Token storage and retrieval is handled in [src/tokens.js](mdc:src/tokens.js)
- Cookie management is implemented in [src/cookies.js](mdc:src/cookies.js)
- Secure storage uses [src/keychain.js](mdc:src/keychain.js)

### Authentication Flow
1. First try to retrieve stored auth from keychain
2. Validate stored auth tokens by making a test API call
3. If validation fails, clear stored auth and fetch fresh tokens
4. Store new auth information (tokens + cookie) for future use

### Key Functions
- `getSlackTokens()`: Retrieves workspace tokens with validation and fallback
- `getSlackAuth()`: Retrieves both tokens and cookie with validation and fallback
- `testSlackAuth()`: Validates auth by testing API access
- `clearStoredAuth()`: Clears stored authentication data

### Workspace Filtering
- Authentication can be filtered by workspace URL or name
- Use the `workspace` option when calling auth functions
- If no matches found, all tokens are returned

### Best Practices
- Always handle potential authentication errors
- Use the cached auth validation when appropriate (1 minute TTL)
- For commands requiring authentication, use `getSlackAuth()` or `getSlackTokens()`
- Consider using the `quiet` option to suppress console messages in non-interactive contexts

## Slack API Usage

### Web API Client
- Use the official `@slack/web-api` package
- Create WebClient instances with tokens from `getSlackTokens()`
- Handle API rate limits and errors appropriately

### Type Definitions
- Use types from `@slack/web-api` when available
- Custom types are defined in [src/types.ts](mdc:src/types.ts)
- Use proper typing for all API requests and responses

### Error Handling
- Always implement proper error handling for API calls
- Consider retry logic for transient failures
- Log useful error information for debugging
