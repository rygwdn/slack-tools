#!/usr/bin/env node
import {Command}from'commander';import {readFileSync,promises,existsSync}from'fs';import {join,dirname}from'path';import {fileURLToPath}from'url';import L from'keytar';import {WebClient,LogLevel}from'@slack/web-api';import {join as join$1}from'node:path';import {platform,homedir as homedir$1}from'node:os';import {promisify}from'node:util';import {exec}from'child_process';import de from'sqlite3';import {open}from'sqlite';import pe from'crypto';import {Level}from'level';import {homedir}from'os';import*as Ie from'fs/promises';import {McpServer}from'@modelcontextprotocol/sdk/server/mcp.js';import {StdioServerTransport}from'@modelcontextprotocol/sdk/server/stdio.js';import {z as z$1}from'zod';var T="slack-tools",ie="slack-cookie";async function ce(r){for(let[e,s]of Object.entries(r.tokens))await L.setPassword(T,e,JSON.stringify(s));r.cookie&&await L.setPassword(T,ie,JSON.stringify(r.cookie));}async function v(){try{let r=await L.findCredentials(T);if(r.length===0)return null;let e={},s=null;for(let t of r)if(t.account===ie)try{s=JSON.parse(t.password);}catch(o){console.error("Failed to parse cookie from keychain:",o);}else try{let o=JSON.parse(t.password);e[t.account]=o;}catch(o){console.error(`Failed to parse token for ${t.account}:`,o);}return Object.keys(e).length===0||!s?null:{tokens:e,cookie:s}}catch(r){return console.error("Failed to read auth from keychain:",r),null}}async function D(){let r=await L.findCredentials(T);for(let e of r)await L.deletePassword(T,e.account);}function me(r){r.command("clear").description("Clear stored authentication from keychain").action(async()=>{try{console.error("Clearing stored authentication from keychain..."),await D(),console.error("Authentication cleared successfully.");}catch(e){console.error("Error:",e),process.exit(1);}});}var lt=promisify(exec);function fe(r,e){try{let s=r.slice(0,3).toString(),t;if(s==="v10"||s==="v11")t=r.slice(3);else throw new Error("Unsupported cookie version");let o=Buffer.from(" ".repeat(16)),n=pe.createDecipheriv("aes-128-cbc",e,o),a=Buffer.concat([n.update(t),n.final()]),i=a.length;for(;i>0&&a[i-1]===0;)i--;return a.slice(0,i).toString("utf8")}catch(s){throw new Error(`Failed to decrypt cookie value: ${s instanceof Error?s.message:String(s)}`)}}async function ut(){try{let{stdout:r}=await lt('security find-generic-password -wa "Slack App Store Key"'),e=r.trim(),s=Buffer.from("saltysalt");return pe.pbkdf2Sync(e,s,1003,16,"sha1")}catch(r){throw new Error(`Could not retrieve Slack encryption key from keychain: ${r instanceof Error?r.message:String(r)}`)}}function dt(){let r=[join$1(homedir$1(),"Library/Application Support/Slack/Cookies"),join$1(homedir$1(),"Library/Containers/com.tinyspeck.slackmacgap/Data/Library/Application Support/Slack/Cookies")];for(let e of r)if(existsSync(e))return e;throw new Error("Could not find Slack's cookies database")}async function _(){try{let r=dt(),e=await ut(),s=await open({filename:r,driver:de.Database,mode:de.OPEN_READONLY});try{let t=await s.all('SELECT name, encrypted_value FROM cookies WHERE name = "d" ORDER BY LENGTH(encrypted_value) DESC');if(!t||t.length===0||!t[0].encrypted_value)throw new Error('Could not find any Slack "d" cookies in cookies database');if(t.length>1){let i=new Set,c=[];for(let m of t)try{let u=fe(m.encrypted_value,e),l=u.indexOf("xoxd-");if(l!==-1){let p=u.substring(l);i.add(p),c.push({...m,decryptedValue:p});}}catch{}if(i.size>1)throw new Error(`Found ${i.size} different Slack tokens in cookies. Please clear unused cookies.`)}let o=t[0],n=fe(o.encrypted_value,e),a=n.indexOf("xoxd-");if(a!==-1){let i=n.substring(a);return {name:o.name,value:i}}if(!n.startsWith("xoxd-"))throw new Error("Decrypted cookie value does not have the required xoxd- prefix");return {name:o.name,value:n}}finally{await s.close();}}catch(r){throw new Error(`Failed to extract Slack cookie: ${r instanceof Error?r.message:String(r)}`)}}function pt(){if(platform()==="darwin"){let r=[join$1(homedir$1(),"Library/Containers/com.tinyspeck.slackmacgap/Data/Library/Application Support/Slack/Local Storage/leveldb"),join$1(homedir$1(),"Library/Application Support/Slack/Local Storage/leveldb")];for(let e of r)if(e)return e;throw new Error("Could not find Slack's Local Storage directory on macOS")}else if(platform()==="linux")return join$1(homedir$1(),".config/Slack/Local Storage/leveldb");throw new Error("slacktokens only works on macOS or Linux.")}async function U(r){let e=pt(),s=new Level(e,{createIfMissing:false});try{await s.open();let t,o=await s.iterator().all();for(let[i,c]of o)if(i.toString().includes("localConfig_v2")){t=c.toString();break}if(!t)throw new Error("Slack's Local Storage not recognised: localConfig not found");let n=JSON.parse(t.slice(1)),a={};for(let i of Object.values(n.teams))a[i.url]={token:i.token,name:i.name};return a}catch(t){if(console.error("Error:",t),t&&typeof t=="object"&&"code"in t){let o=t;if(o.code==="LEVEL_DATABASE_NOT_OPEN"&&o.cause?.code==="LEVEL_LOCKED")throw new Error(`Slack's Local Storage database is locked. Please make sure Slack is completely closed:
1. Quit Slack from the menu bar
2. Check Activity Monitor/Task Manager to ensure no Slack processes are running
3. Try running this command again`)}throw t}finally{r?.debug&&r.debugLog("Closing database"),s.status==="open"&&await s.close();}}var N=false;function we(r,e,s){return new WebClient(r,{headers:{Cookie:`d=${e.value}`},logLevel:s?.debug?LogLevel.DEBUG:LogLevel.ERROR})}async function ke(r,e){let s=Object.values(r.tokens)[0]?.token;if(!s)throw new Error("Auth test failed: No token found");try{if(!(await we(s,r.cookie,e).auth.test()).ok)throw new Error("Auth test failed: API returned not ok")}catch(t){throw console.error("Auth test API call failed:",t),new Error("Auth test failed: API call error")}}async function X(r){let e={cookie:await _(),tokens:await U(r)};return await ke(e,r),await ce(e),e}async function ht(r){let e=await v();if(e?.cookie&&e?.tokens)try{return await ke(e,r),N=!0,e}catch(s){console.error("Auth error encountered, clearing stored credentials and retrying...",s),await D();let t=await X(r);return N=true,t}else {let s=await X(r);return N=true,s}}function A(r,e,s){if(!r.cookie)throw new Error("No cookie found in auth");if(s.debugLog("Available workspaces:",Object.keys(r.tokens).join(", ")),s.debugLog("Looking for workspace:",e),r.tokens[e]){let o=r.tokens[e].token;return s.debugLog(`Found token for workspace URL: ${e}`),s.debugLog(`Token: ${o.substring(0,5)}...${o.substring(o.length-5)}`),{token:o,workspaceUrl:e,cookie:r.cookie}}let t=Object.entries(r.tokens).find(([,o])=>o.name.toLowerCase()===e.toLowerCase());if(t){let o=t[1].token;return s.debugLog(`Found token for workspace name: ${t[1].name}`),s.debugLog(`Workspace URL: ${t[0]}`),s.debugLog(`Token: ${o.substring(0,5)}...${o.substring(o.length-5)}`),{token:o,workspaceUrl:t[0],cookie:r.cookie}}throw s.debugLog("All available workspaces:"),Object.entries(r.tokens).forEach(([o,n])=>{s.debugLog(`- ${n.name} (${o})`);}),new Error(`Could not find workspace "${e}". Use 'slack-tools print' to see available workspaces.`)}async function w(r,e){let s=N?await v()||await X(e):await ht(e),{token:t,cookie:o,workspaceUrl:n}=A(s,r,e);if(e.debugLog(`Using workspace: ${n}`),!t.startsWith("xoxc-"))throw new Error(`Invalid token format: token should start with 'xoxc-'. Got: ${t}`);return we(t,o,e)}function ye(r,e){r.command("print").description("Print tokens and cookie").option("-q, --quiet","Suppress output and only show tokens/cookies").action(async s=>{try{s.quiet||console.log("Getting Slack credentials...");let t=e.hasWorkspace?e.workspace:"default",o=await v();!s.quiet&&!o&&console.log("No stored auth found, fetching fresh credentials...");let n=o||{cookie:await _(),tokens:await U(e)};try{let{token:a,cookie:i,workspaceUrl:c}=A(n,t,e);s.quiet?(console.log(a),console.log(i.value)):(console.log(`
Found token for workspace:
`),console.log(`Workspace URL: ${c}`),console.log(`Token: ${a}
`),console.log("Found cookie:"),console.log(`${i.name}: ${i.value}
`));}catch(a){if(e.hasWorkspace)console.error(`Error getting workspace "${e.workspace}":`,a),process.exit(1);else try{let i=Object.keys(n.tokens)[0];if(!i)throw new Error("No workspaces available");let{token:c,cookie:m,workspaceUrl:u}=A(n,i,e);s.quiet?(console.log(c),console.log(m.value)):(console.log(`
Found token for workspace:
`),console.log(`Workspace URL: ${u}`),console.log(`Token: ${c}
`),console.log("Found cookie:"),console.log(`${m.name}: ${m.value}
`),console.log(`
Tip: To specify a workspace directly, use:`),console.log("  - Use -w, --workspace <workspace> to specify a workspace"),console.log("  - Use -l, --last-workspace to use your most recently used workspace"));}catch(i){console.error("Error getting any workspace token:",i),process.exit(1);}}}catch(t){console.error("Error:",t),process.exit(1);}});}async function Ce(r,e){let s;if(r.since){if(s=new Date(r.since),isNaN(s.getTime()))throw new Error(`Invalid start date: ${r.since}, use YYYY-MM-DD format`)}else {let o=new Date;s=new Date(o),s.setHours(0,0,0,0),e.debugLog(`Using start date: ${s.toISOString()}`);}let t;if(r.until){if(t=new Date(r.until),isNaN(t.getTime()))throw new Error(`Invalid end date: ${r.until}, use YYYY-MM-DD format`);t.setHours(23,59,59,999);}else {let o=new Date;t=new Date(o),t.setHours(23,59,59,999),e.debugLog(`Using end date: ${t.toISOString()}`);}return {startTime:s,endTime:t}}function ee(r){return r.toISOString().split("T")[0]}function Se(r){let e=new Date(r);return e.setDate(e.getDate()-1),e}function be(r){let e=new Date(r);return e.setDate(e.getDate()+1),e}async function wt(r,e,s){let t=e.replace(/^@/,"").replace(/^"(.*)"$/,"$1");try{if(/^U[A-Z0-9]{8,}$/.test(t)){let c=await r.users.info({user:t});if(c.ok&&c.user)return `<@${t}>`}if(/.+@.+\..+/.test(t)){let c=await r.users.lookupByEmail({email:t});if(c.ok&&c.user)return `<@${c.user.id}>`}let n=(await r.users.list({})).members||[],a=n.find(c=>c.profile?.real_name?.toLowerCase()===t.toLowerCase()||c.profile?.display_name?.toLowerCase()===t.toLowerCase()||c.name?.toLowerCase()===t.toLowerCase());if(a)return `<@${a.id}>`;let i=n.filter(c=>c.profile?.real_name?.toLowerCase().includes(t.toLowerCase())||c.profile?.display_name?.toLowerCase().includes(t.toLowerCase())||c.name?.toLowerCase().includes(t.toLowerCase()));return i.length===1?`<@${i[0].id}>`:i.length>1?(s.debugLog(`Multiple users found matching "${t}". Using the first match.`),`<@${i[0].id}>`):(s.debugLog(`No user found matching "${t}". Using as-is.`),`@${t}`)}catch(o){return s.debugLog(`Error resolving user "${e}": ${o}`),`@${t}`}}async function $e(r,e,s){let t=/(from:|to:|with:)@?(("([^"]+)")|([^\s]+))/g,o=Array.from(e.matchAll(t));if(o.length===0)return e;let n=e;for(let a of o){let[i,c,m,u,l,p]=a,h=await wt(r,l||p,s),k=`${c}${h}`;n=n.replace(i,k);}return s.debugLog(`Enhanced query: "${n}"`),n}async function Me(r,e,s,t,o){if(!e)throw new Error("Username is required for searching messages");let n=Se(s.startTime),a=be(s.endTime),i=ee(n),c=ee(a),m=`from:${e} after:${i} before:${c}`;o.debugLog(`Search query: ${m}`);let u=await $(r,m,t,o),l=`is:thread with:@${e} after:${i} before:${c}`;o.debugLog(`Thread query: ${l}`);let p=await $(r,l,t,o),g=`to:${e} after:${i} before:${c}`;o.debugLog(`Mention query: ${g}`);let h=await $(r,g,t,o);return {messages:u,threadMessages:p,mentionMessages:h}}async function $(r,e,s,t){t.debugLog(`Original search query: ${e}`);let o=await $e(r,e,t);t.debugLog(`Executing search with enhanced query: ${o}`);try{return (await r.search.messages({query:o,sort:"timestamp",sort_dir:"asc",count:s})).messages?.matches||[]}catch(n){throw t.debugLog(`Search error: ${n}`),new Error(`Failed to search Slack: ${n}`)}}var oe=join(homedir(),".slack-tools"),xe=join(oe,"config.json"),Le=join(oe,"slack-cache.json"),yt=24*60*60*1e3,te={lastWorkspace:null};async function R(){try{await promises.mkdir(oe,{recursive:!0});}catch(r){throw console.error("Failed to create config directory:",r),new Error(`Could not create cache directory: ${r.message}`)}}async function Te(){await R();try{let r=await promises.readFile(xe,"utf8");return {...te,...JSON.parse(r)}}catch(r){return r.code==="ENOENT"||console.error("Failed to load config:",r),te}}async function Ct(r){await R();try{await promises.writeFile(xe,JSON.stringify(r,null,2));}catch(e){throw console.error("Failed to save config:",e),new Error(`Could not save cache configuration: ${e.message}`)}}async function ve(){return (await Te()).lastWorkspace}async function Ee(r){let e=await Te();e.lastWorkspace=r,await Ct(e);}async function De(r=Le,e=yt){try{await R();let s=await promises.readFile(r,"utf-8"),t=JSON.parse(s);if(Date.now()-t.lastUpdated<e)return t}catch{}return null}async function M(r,e=Le){await R(),await promises.writeFile(e,JSON.stringify(r,null,2));}function St(r){let e=new Set,s=new Set;for(let t of r){t.user&&e.add(t.user),t.channel?.id&&s.add(t.channel.id);let o=/<@([A-Z0-9]+)>/g,n=t.text?.match(o)||[];for(let c of n){let m=c.slice(2,-1);e.add(m);}let a=/<#([A-Z0-9]+)(\|[^>]+)?>/g,i=(t.text||"").match(a)||[];for(let c of i){let m=c.slice(2).split("|")[0];s.add(m);}}return {userIds:e,channelIds:s}}async function bt(r,e,s,t,o){for(let n of e)try{let a=await r.users.info({user:n});a.ok&&a.user&&(s.users[n]={displayName:a.user.real_name||a.user.name||n,isBot:!!a.user.is_bot||(a.user.name||"").includes("bot")},o&&t.debugLog(`Added missing user to cache: ${s.users[n].displayName}`));}catch(a){t.debugLog(`Could not fetch info for user ${n}:`,a);}}async function $t(r,e,s,t,o){if(!s.users[e])try{let n=await r.users.info({user:e});n.ok&&n.user&&(s.users[e]={displayName:n.user.real_name||n.user.name||e,isBot:!!n.user.is_bot||(n.user.name||"").includes("bot")},o&&t.debugLog(`Added missing DM user to cache: ${s.users[e].displayName}`));}catch(n){t.debugLog(`Could not fetch info for DM user ${e}:`,n);}}async function Mt(r,e,s){try{return (await r.conversations.members({channel:e})).members||[]}catch(t){s.debugLog(`Could not fetch members for channel ${e}:`,t);return}}async function xt(r,e,s,t,o,n){for(let a of e)try{let i=await r.conversations.info({channel:a});if(i.ok&&i.channel){let c=i.channel,m=c.name||a,u;if(c.is_im){let l="user"in c?c.user:void 0;l&&(n.add(l),await $t(r,l,s,t,o),u=[l]);}else c.is_mpim&&(u=await Mt(r,a,t));s.channels[a]={displayName:m,type:c.is_im?"im":c.is_mpim?"mpim":"channel",members:u},o&&t.debugLog(`Added missing channel to cache: ${m}`);}}catch(i){t.debugLog(`Could not fetch info for channel ${a}:`,i);}}async function Lt(){return await De()||{users:{},channels:{},lastUpdated:0}}async function x(r,e,s){let t=await Lt(),o=t.lastUpdated>0,{userIds:n,channelIds:a}=St(e),i=Array.from(n).filter(m=>!t.users[m]),c=Array.from(a).filter(m=>!t.channels[m]);return o?(s.debugLog("Using cached user and channel information with updates for missing entries"),s.debugLog(`Found ${i.length} users and ${c.length} channels missing from cache`)):s.debugLog("No cache found, fetching all user and channel information"),await bt(r,i,t,s,o),await xt(r,c,t,s,o,n),t.lastUpdated=Date.now(),await M(t),t}async function I(r,e,s){try{let t=s.workspace,o=await w(t,s),a=(await o.auth.test()).user_id;s.debugLog(`Searching messages with query: ${r}`);let i=await $(o,r,e,s);s.debugLog(`Found ${i.length} matching messages. Fetching details...`);let c=await x(o,i,s);return c.lastUpdated=Date.now(),await M(c),{messages:i,userId:a,channels:c.channels,users:c.users}}catch(t){throw new Error(`Search failed: ${t}`)}}function se(r){if(!r)return "";let e=r;return e.startsWith(":")||(e=`:${e}:`),e.endsWith(":")||(e=`${e}:`),e}function Tt(r){return r?Math.floor(Date.now()/1e3)+r*60:0}async function P(r,e,s,t){try{let o=e.workspace;e.debugLog("Setting status for workspace:",o);let n=se(s||"");n&&e.debugLog("Using emoji:",n);let a=Tt(t);t?e.debugLog("Status will expire in",t,"minutes at",new Date(a*1e3).toISOString()):e.debugLog("Setting permanent status (no expiration)");let c=await(await w(o,e)).users.profile.set({profile:{status_text:r,status_emoji:n,status_expiration:a}});return e.debugLog("API response:",c),{success:!0,text:r,emoji:n,expirationTime:a?new Date(a*1e3).toISOString():null}}catch(o){throw new Error(`Status update failed: ${o}`)}}async function _e(r){try{let e=r.workspace,t=await(await w(e,r)).users.profile.get({});return {status:t.profile?.status_text||"",emoji:t.profile?.status_emoji||"",expirationTime:t.profile?.status_expiration?new Date(Number(t.profile.status_expiration)*1e3).toISOString():null}}catch(e){throw new Error(`Status retrieval failed: ${e}`)}}async function F(r,e,s,t){try{let o=s.workspace;s.debugLog("Creating reminder for workspace:",o),s.debugLog("Reminder text:",r),s.debugLog("Reminder time:",e),t&&s.debugLog("Reminder for user:",t);let a=await(await w(o,s)).reminders.add({text:r,time:e,user:t});return s.debugLog("API response:",a),{success:!0,reminder:a.reminder}}catch(o){throw new Error(`Reminder creation failed: ${o}`)}}async function W(r,e,s,t){try{let o=s.workspace;s.debugLog("Getting thread replies in workspace:",o),s.debugLog("Channel:",r),s.debugLog("Thread timestamp:",e),t&&s.debugLog("Limit:",t);let n=await w(o,s),i=(await n.conversations.replies({channel:r,ts:e,limit:t})).messages?.filter(u=>u.ts!==e)||[];s.debugLog("Found replies:",i.length);let c=i.map(u=>({iid:u.ts,ts:u.ts,text:u.text,user:u.user,channel:{id:r},team:u.team})),m=await x(n,c,s);return {replies:i,channels:m.channels,users:m.users}}catch(o){throw new Error(`Getting thread replies failed: ${o}`)}}async function O(r,e,s){try{let t=e.workspace;e.debugLog("Getting user activity for workspace:",t),s&&e.debugLog("User:",s);let o=await w(t,e),n=s;n||(n=(await o.auth.test()).user_id,e.debugLog("Using current user ID:",n));let a=`from:<@${n}>`,i=await $(o,a,r,e);e.debugLog(`Found ${i.length} messages for user`);let c=await x(o,i,e),m={};i.forEach(l=>{let p=l.channel?.id||"unknown";m[p]=(m[p]||0)+1;});let u=Object.entries(m).map(([l,p])=>({channelId:l,channelName:c.channels[l]?.displayName||"Unknown channel",messageCount:p}));return u.sort((l,p)=>p.messageCount-l.messageCount),{userId:n,totalMessages:i.length,channelBreakdown:u,timePeriod:`Last ${r} messages`}}catch(t){throw new Error(`Getting user activity failed: ${t}`)}}async function Ue(r,e){try{let s=e.workspace,t=await w(s,e),o=await t.users.info({user:r});if(!o.ok||!o.user)throw new Error(`User not found: ${r}`);let n=await t.users.profile.get({user:r});if(!n.ok||!n.profile)throw new Error(`Profile not found for user: ${r}`);return {userId:r,username:o.user.name,realName:o.user.real_name,displayName:n.profile.display_name||o.user.real_name||o.user.name,email:n.profile.email,phone:n.profile.phone,title:n.profile.title,teamId:o.user.team_id,timezone:o.user.tz,timezoneLabel:o.user.tz_label,avatarUrl:n.profile.image_original||n.profile.image_512,status:{text:n.profile.status_text||"",emoji:n.profile.status_emoji||"",expiration:n.profile.status_expiration?new Date(Number(n.profile.status_expiration)*1e3).toISOString():null},isBot:o.user.is_bot||!1,isAdmin:o.user.is_admin||!1,isOwner:o.user.is_owner||!1,isRestricted:o.user.is_restricted||!1,isUltraRestricted:o.user.is_ultra_restricted||!1,updated:o.user.updated?new Date(Number(o.user.updated)*1e3).toISOString():null}}catch(s){throw new Error(`User profile retrieval failed: ${s}`)}}function Ne(r,e){r.command("status <text>").description("Set your Slack status").option("--emoji <emoji>","Emoji for the status (optional)").option("--duration <duration>","Duration in minutes before status expires (omit for permanent)").action(async(s,t)=>{try{let o=t.emoji||"",n=se(o),a;t.duration?(a=parseInt(t.duration,10),console.log(`Setting status to "${s}"${n?` with emoji ${n}`:""} for ${a} minutes`)):console.log(`Setting status to "${s}"${n?` with emoji ${n}`:""} permanently`),await P(s,e,o,a),console.log("Status set successfully!");}catch(o){console.error("Error:",o),e.debug||console.log(`
Tip: Run with -d/--debug flag for more troubleshooting information`),process.exit(1);}});}function Ae(r,e){r.command("test").description("Test authentication with Slack API").action(async s=>{try{let t=e.workspace;e.debugLog("Testing authentication for workspace:",t),console.log("Testing auth for workspace:",t);let o=await w(t,e);e.debugLog("Calling auth.test API endpoint");let n=await o.auth.test();e.debugLog("Full API response:",n),console.log(`
API Response:`),console.log(JSON.stringify(n,null,2));}catch(t){console.error("Error:",t),e.debug||console.log(`
Tip: Run with -d/--debug flag for more troubleshooting information`),process.exit(1);}});}function S(r,e,s){let t=e.channels[r];if(!t)return r;if(t.type==="channel")return `#${t.displayName}`;if(t.type==="im"&&t.members&&t.members.length>0){let o=t.members[0],n=e.users[o];return `DM with ${n?n.displayName:t.displayName}`}return t.type==="mpim"&&t.members?`Group DM with ${t.members.filter(n=>n!==s).map(n=>e.users[n]?.displayName||n).join(", ")}`:r}function B(r,e){return r?(r=r.replace(/<@([A-Z0-9]+)(?:\|([^>]+))?>/g,(s,t,o)=>{let n=e.users[t];return n?`@${n.displayName}`:o?`@${o}`:s}),r=r.replace(/<#([A-Z0-9]+)(?:\|([^>]+))?>/g,(s,t,o)=>{if(o)return `#${o}`;let n=e.channels[t];return n?`#${n.displayName}`:s}),r=r.replace(/<((?:https?:\/\/)[^|>]+)\|([^>]+)>/g,"[$2]($1)"),r=r.replace(/<((?:https?:\/\/)[^>]+)>/g,"$1"),r.split(`
`).join(`
    `)):""}function Y(r){let e=r.getHours().toString().padStart(2,"0"),s=r.getMinutes().toString().padStart(2,"0");return `${e}:${s}`}function vt(r){return typeof r.ts=="string"}function Et(r){if(r)try{return new URL(r).searchParams.get("thread_ts")||void 0}catch{return}}function Dt(r,e,s,t,o){let n=e.some(i=>{let c=i.user===t,m=i.threadMessages?.some(u=>u.user===t)??false;return c||m}),a=s.channels[r];if(!a)return  true;if(a.type==="im"){let c=s.users[a.members?.[0]||""]?.isBot||false,m=n||!c;return m||o.debugLog(`Filtering out bot channel: ${S(r,s,t)}`),m}return  true}function _t(r,e){let s=new Map,t=[];for(let o of r){if(!vt(o)){e.debugLog("Skipping message without timestamp");continue}let n=o.thread_ts||Et(o.permalink);if(n&&o.ts!==n){s.has(n)||s.set(n,[]);let a=s.get(n);if(!a.some(i=>i.ts===o.ts)){let i={...o,thread_ts:n};a.push(i),e.debugLog(`Added message to thread: ${o.text?.slice(0,50)}`);}}else t.push(o),e.debugLog(`Added standalone/parent message: ${o.ts} ${n} ${o.text?.slice(0,50)}`);}return {threadMap:s,standaloneMessages:t}}function j(r,e=[],s,t){let n=new Date(Number(r.ts)*1e3).toISOString().split("T")[0],a=r.channel?.id||"unknown";s.has(n)||s.set(n,new Map);let i=s.get(n);i.has(a)||i.set(a,[]);let c=i.get(a);e.length>0&&t.debugLog(`Adding message with ${e.length} thread replies to ${a}`),c.push({...r,threadMessages:e});}function Ut(r,e,s){let t=new Map;for(let o of r)if(o.ts&&e.has(o.ts)){let a=e.get(o.ts).filter(i=>i.ts!==o.ts);j(o,a,t,s);}else j(o,[],t,s);for(let[o,n]of e.entries()){if(r.some(c=>c.ts===o))continue;let a=n.sort((c,m)=>Number(c.ts)-Number(m.ts)),i=a.find(c=>c.ts===o);if(i){let c=a.filter(m=>m.ts!==i.ts);j(i,c,t,s);}else {let c=a[0];s.debugLog(`Thread ${o} missing parent, using first reply as parent`);let m={...c,thread_ts:o,ts:o,text:c.text,user:c.user,channel:c.channel},u=a.filter(l=>l.ts!==c.ts);j(m,u,t,s);}}return t}function Nt(r,e,s){let t="",o=new Date(Number(r.ts)*1e3),n=Y(o),a=r.username||"Unknown User";r.user&&e.users[r.user]&&(a=e.users[r.user].displayName),s.debugLog(`Formatting message from ${a}`),t+=`- [*${n}*](${r.permalink||""}) **${a}**: `;let c=B(r.text||"",e).split(`
`);if(t+=c[0]+`
`,c.length>1){let m="    ";t+=c.slice(1).map(u=>`${m}${u}`).join(`
`)+`
`;}return t}function At(r,e){let s="",t=r.sort((o,n)=>Number(o.ts)-Number(n.ts));for(let o of t){let n=new Date(Number(o.ts)*1e3),a=Y(n),i=o.username||"Unknown User";o.user&&e.users[o.user]&&(i=e.users[o.user].displayName),s+="        - ",o.permalink?s+=`[*${a}*](${o.permalink})`:s+=`*${a}*`;let m=B(o.text||"",e).split(`
`);if(s+=` **${i}**: ${m[0]}
`,m.length>1){let u="            ";s+=m.slice(1).map(l=>`${u}${l}`).join(`
`)+`
`;}}return s}function Re(r,e,s,t){let o="";t.debugLog(`Processing ${r.length} total messages`);let{threadMap:n,standaloneMessages:a}=_t(r,t),i=Ut(a,n,t),c=Array.from(i.keys()).sort();for(let m of c){let u=new Date(m);o+=`# ${u.toDateString()}

`;let l=i.get(m),p=Array.from(l.entries()).map(([g,h])=>[g||"unknown",h]).filter(([g,h])=>Dt(g,h,e,s,t)).sort(([g],[h])=>{let k=S(g,e,s),b=S(h,e,s);return k.localeCompare(b)});for(let[g,h]of p){let k=S(g,e,s);o+=`## ${k}

`;let b=h.sort((y,Q)=>Number(y.ts)-Number(Q.ts));for(let y of b)o+=Nt(y,e,t),y.threadMessages?.length&&(t.debugLog(`Adding ${y.threadMessages.length} thread replies for message: ${y.text?.slice(0,50)}`),o+=At(y.threadMessages,e),o+=`
`);o+=`
`;}}return o}async function z(r,e){let s=await Ce(r,e),t=await w(e.workspace,e),o=await t.auth.test(),n=o.user_id,a=r.username||o.user;e.debugLog(`Generating my messages summary for user: ${a}`),e.debugLog(`Date range: ${s.startTime.toLocaleDateString()} to ${s.endTime.toLocaleDateString()}`);let{messages:i,threadMessages:c,mentionMessages:m}=await Me(t,a,s,r.count,e),u=[...i,...c,...m];e.debugLog(`Found ${i.length} direct messages, ${c.length} thread messages, and ${m.length} mention messages`),e.debugLog(`Found ${u.length} total messages. Fetching details...`);let l=await x(t,u,e);e.debugLog("Formatting report...");let p=Re(u,l,n,e);return l.lastUpdated=Date.now(),await M(l),{markdown:p,allMessages:u,userId:n,dateRange:s,cache:l}}function Pe(r,e){r.command("my-messages").description("Generate a summary of your Slack activity including messages you sent and messages mentioning you").option("-u, --username <username>","Slack username to filter by").option("-s, --since <date>","Start date (YYYY-MM-DD format), defaults to today").option("-e, --until <date>","End date (YYYY-MM-DD format), defaults to today").option("-c, --count <number>","Number of messages to fetch (default: 200)","200").option("-o, --output <file>","Output markdown to a file").action(async s=>{try{let t=e.workspace,o=parseInt(s.count,10);e.debugLog(`Generating daily summary for workspace: ${t}`);let n=await z({username:s.username,since:s.since,until:s.until,count:o},e);s.output?(await Ie.writeFile(s.output,n.markdown),console.log(`Report written to: ${s.output}`)):console.log(n.markdown);}catch(t){console.error("Error:",t),process.exit(1);}});}function G(r,e,s,t){let o="";if(r.length===0)return t.debugLog("No search results found"),`# Search Results

No messages found matching your search criteria.
`;t.debugLog(`Processing ${r.length} search results`);let n=new Map;for(let i of r){let c=i.channel?.id||"unknown";n.has(c)||n.set(c,[]),n.get(c).push(i);}let a=Array.from(n.keys()).sort((i,c)=>{let m=S(i,e,s),u=S(c,e,s);return m.localeCompare(u)});o+=`# Search Results

`;for(let i of a){let c=n.get(i),m=S(i,e,s);o+=`## ${m}

`;let u=c.sort((l,p)=>!l.ts||!p.ts?0:Number(l.ts)-Number(p.ts));for(let l of u){if(!l.ts)continue;let p=new Date(Number(l.ts)*1e3),g=p.toLocaleDateString(),h=Y(p),k=l.username||"Unknown User";l.user&&e.users[l.user]&&(k=e.users[l.user].displayName),o+=`- **${g}** [${h}](${l.permalink||""}) **${k}**: `;let y=B(l.text||"",e).split(`
`);if(o+=y[0]+`
`,y.length>1){let Q="    ";o+=y.slice(1).map(nt=>`${Q}${nt}`).join(`
`)+`
`;}o+=`
`;}o+=`
`;}return o}function Fe(r){let e=`# Current Slack Status

`;if(!r.status&&!r.emoji)return e+=`No status is currently set.
`,e;if(r.emoji?e+=`**Status:** ${r.emoji} ${r.status}

`:e+=`**Status:** ${r.status}

`,r.expirationTime){let s=new Date(r.expirationTime);e+=`**Expires:** ${s.toLocaleString()}
`;}else e+=`**Expires:** Never (permanent status)
`;return e}function We(r){let e=`# Status Update

`;if(r.success)if(e+=`\u2705 Status updated successfully

`,r.emoji?e+=`**New Status:** ${r.emoji} ${r.text}

`:e+=`**New Status:** ${r.text}

`,r.expirationTime){let s=new Date(r.expirationTime);e+=`**Expires:** ${s.toLocaleString()}
`;}else e+=`**Expires:** Never (permanent status)
`;else e+=`\u274C Failed to update status

`;return e}function je(r,e){r.command("search <query>").description("Search Slack messages and output results as markdown").option("-c, --count <number>","Number of messages to fetch (default: 100)","100").option("-o, --output <file>","Output markdown to a file").action(async(s,t)=>{try{let o=parseInt(t.count,10);e.debugLog(`Searching Slack for: "${s}"`);let n=await I(s,o,e),a=n.messages,i=n.userId,c={lastUpdated:Date.now(),channels:n.channels,users:n.users};e.debugLog("Formatting report...");let m=G(a,c,i,e);t.output?(await Ie.writeFile(t.output,m),console.log(`Search results written to: ${t.output}`)):console.log(m);}catch(o){console.error("Error:",o),process.exit(1);}});}function Be(r,e){r.tool("slack_my_messages",{username:z$1.string().optional().describe("Username or display name to fetch messages for. If omitted, fetches messages for the current user."),since:z$1.string().optional().describe('Start date in YYYY-MM-DD format (e.g., "2023-01-15"). If omitted, defaults to the beginning of the current day.'),until:z$1.string().optional().describe('End date in YYYY-MM-DD format (e.g., "2023-01-15"). If omitted, defaults to the end of the current day.'),count:z$1.number().optional().default(200).describe("Maximum number of messages to retrieve (1-1000). Default is 200.")},async({username:s,since:t,until:o,count:n})=>{try{return {content:[{type:"text",text:(await z({username:s,since:t,until:o,count:n},e)).markdown}]}}catch(a){return {content:[{type:"text",text:`Error: ${a}`}],isError:true}}});}function ze(r,e){r.tool("slack_search",{query:z$1.string().describe('Search query with Slack search modifiers. Supports operators like "from:", "to:", "with:", "in:", "has:", etc. For user searches, use from:@username (e.g., from:@john.doe) or from:"Display Name" (with quotes for names with spaces). For channel searches, use in:channel_name (e.g., in:general) or in:<#C12345> (using channel ID). Use the slack_user_search or slack_channel_search tools first to find the correct format if needed.'),count:z$1.number().optional().default(100).describe("Maximum number of results to return (1-1000). Default is 100.")},async({query:s,count:t})=>{try{let o=await I(s,t,e),n={lastUpdated:Date.now(),channels:o.channels,users:o.users};return {content:[{type:"text",text:G(o.messages,n,o.userId,e)}]}}catch(o){return {content:[{type:"text",text:`Error: ${o}`}],isError:true}}});}function Ge(r,e){r.tool("slack_set_status",{text:z$1.string().describe("Status text to display (up to 100 characters)"),emoji:z$1.string().optional().describe('Emoji code to display with status (without colons, e.g. "computer" for :computer:)'),duration:z$1.number().optional().describe("Duration in minutes before automatically clearing the status")},async({text:s,emoji:t,duration:o})=>{try{let n=await P(s,e,t,o);return {content:[{type:"text",text:We(n)}]}}catch(n){return {content:[{type:"text",text:`Error: ${n}`}],isError:true}}}),r.tool("slack_get_status",{description:z$1.string().describe("Gets the current user's Slack status including status text and emoji")},async()=>{try{let s=await _e(e);return {content:[{type:"text",text:Fe(s)}]}}catch(s){return {content:[{type:"text",text:`Error: ${s}`}],isError:true}}});}function qe(r,e){r.tool("slack_create_reminder",{text:z$1.string().describe("The reminder text (what you want to be reminded about)"),time:z$1.string().describe('When to send the reminder. Supports unix timestamp, ISO datetime (YYYY-MM-DDTHH:MM:SS), or natural language like "in 5 minutes", "tomorrow at 9am", "next Monday"'),user:z$1.string().optional().describe('Slack user ID to create the reminder for. If omitted, creates reminder for the current user. Must start with "U" followed by alphanumeric characters.')},async({text:s,time:t,user:o})=>{try{let n=await F(s,t,e,o);return {content:[{type:"text",text:`
## Reminder Created
- **Text:** ${s}
- **Time:** ${t}
${o?`- **User:** ${o}`:""}
- **Success:** ${n.success?"\u2705":"\u274C"}
          `.trim()}]}}catch(n){return {content:[{type:"text",text:`Error: ${n}`}],isError:true}}});}function Je(r,e){r.tool("slack_get_thread_replies",{channel:z$1.string().describe("Slack channel ID where the thread is located (starts with C, D, or G followed by alphanumeric characters)"),ts:z$1.string().describe('Timestamp of the parent message in Unix epoch time format (e.g., "1234567890.123456")'),limit:z$1.number().optional().describe("Maximum number of replies to fetch (1-1000). If not specified, defaults to all replies.")},async({channel:s,ts:t,limit:o})=>{try{let n=await W(s,t,e,o),a=`## Thread Replies

`;return n.replies.length===0?a+="No replies found in this thread.":(a+=`Found ${n.replies.length} replies:

`,n.replies.forEach((i,c)=>{let m=n.users[i.user??""]?.displayName||i.user,u=i.ts?new Date(parseInt(i.ts)*1e3).toLocaleString():"Unknown time";a+=`### Reply ${c+1}
`,a+=`- **From:** ${m}
`,a+=`- **Time:** ${u}
`,a+=`- **Text:** ${i.text||""}

`;})),{content:[{type:"text",text:a}]}}catch(n){return {content:[{type:"text",text:`Error: ${n}`}],isError:true}}});}function Ke(r,e){r.tool("slack_user_activity",{count:z$1.number().optional().default(100).describe("Number of recent messages to analyze (1-1000). Default is 100."),user:z$1.string().optional().describe(`Slack user ID to analyze activity for (e.g. "U12345678"). If omitted, analyzes the current user's activity.`)},async({count:s,user:t})=>{try{let o=await O(s,e,t),n=`## User Activity Summary

`;return n+=`- **User:** ${o.userId}
`,n+=`- **Total Messages:** ${o.totalMessages}
`,n+=`- **Time Period:** ${o.timePeriod}

`,n+=`### Channel Breakdown

`,o.channelBreakdown.length===0?n+="No channel activity found.":(n+=`| Channel | Message Count | % of Total |
`,n+=`| ------- | ------------- | ---------- |
`,o.channelBreakdown.forEach(a=>{let i=(a.messageCount/o.totalMessages*100).toFixed(1);n+=`| ${a.channelName} | ${a.messageCount} | ${i}% |
`;})),{content:[{type:"text",text:n}]}}catch(o){return {content:[{type:"text",text:`Error: ${o}`}],isError:true}}});}function Ve(r,e){r.tool("slack_user_search",{query:z$1.string().describe("A search term to find Slack users. Can be a display name, username, or partial match."),limit:z$1.number().int().min(1).max(100).describe("Maximum number of users to return in the results.")},async({query:s,limit:t})=>{try{let o=e.workspace,n=await w(o,e),a=s.trim().replace(/^@/,"");if(!a)return {content:[{type:"text",text:"Please provide a search term to find users."}],isError:!0};let i=await n.users.list({limit:t});if(!i.ok||!i.members)return {content:[{type:"text",text:"Failed to retrieve user list from Slack."}],isError:!0};let c=i.members.filter(l=>l.deleted||l.is_bot?!1:l.profile?.display_name?.toLowerCase().includes(a.toLowerCase())||l.profile?.real_name?.toLowerCase().includes(a.toLowerCase())||l.name?.toLowerCase().includes(a.toLowerCase()));if(c.length===0)return {content:[{type:"text",text:`No users found matching "${s}".`}]};let m=c.map(l=>{let p=l.profile?.display_name||"",g=l.profile?.real_name||"",k=`@${l.name||""}`,b=p.includes(" ")?`from:"${p}"`:`from:${k}`;return {id:l.id,username:k,display_name:p,real_name:g,search_format:b}});m.sort((l,p)=>l.username.toLowerCase()===`@${a.toLowerCase()}`?-1:p.username.toLowerCase()===`@${a.toLowerCase()}`?1:l.display_name.toLowerCase()===a.toLowerCase()?-1:p.display_name.toLowerCase()===a.toLowerCase()?1:l.display_name.localeCompare(p.display_name));let u=`## User Search Results for "${s}"

`;return u+=`| User | Display Name | Search Format |
`,u+=`|------|-------------|---------------|
`,m.forEach(l=>{u+=`| ${l.username} | ${l.display_name||l.real_name} | \`${l.search_format}\` |
`;}),u+=`
*Found ${m.length} matching users*
`,u+=`
To search for messages from these users, use the search format in the slack_search tool.`,{content:[{type:"text",text:u}]}}catch(o){return {content:[{type:"text",text:`Error searching for users: ${o}`}],isError:true}}});}function Ze(r,e){r.tool("slack_get_user_profile",{user_id:z$1.string().describe('Slack user ID to get profile information for. Must start with "U" followed by alphanumeric characters.')},async({user_id:s})=>{try{let t=await Ue(s,e),o=`## Slack User Profile: ${t.displayName}

`;if(o+=`### Basic Information
`,o+=`- **User ID:** \`${t.userId}\`
`,o+=`- **Username:** @${t.username}
`,o+=`- **Display Name:** ${t.displayName}
`,o+=`- **Real Name:** ${t.realName||"Not set"}
`,o+=`- **Job Title:** ${t.title||"Not set"}
`,o+=`- **Email:** ${t.email||"Not available"}
`,o+=`- **Phone:** ${t.phone||"Not set"}
`,o+=`
### Status
`,o+=`- **Current Status:** ${t.status.text?t.status.text:"No status set"} ${t.status.emoji||""}
`,t.status.expiration&&(o+=`- **Status Expiration:** ${t.status.expiration}
`),o+=`
### Account Information
`,o+=`- **Team ID:** ${t.teamId||"Unknown"}
`,o+=`- **Timezone:** ${t.timezone||"Unknown"} (${t.timezoneLabel||""})
`,o+=`- **Account Type:** ${t.isBot?"Bot":"User"}
`,t.isAdmin||t.isOwner){let n=[];t.isOwner&&n.push("Owner"),t.isAdmin&&n.push("Admin"),o+=`- **Roles:** ${n.join(", ")}
`;}if(t.isRestricted||t.isUltraRestricted){let n=[];t.isRestricted&&n.push("Restricted"),t.isUltraRestricted&&n.push("Ultra Restricted"),o+=`- **Restrictions:** ${n.join(", ")}
`;}return o+=`- **Last Updated:** ${t.updated||"Unknown"}
`,t.avatarUrl&&(o+=`
### Profile Image
`,o+=`![${t.displayName}'s profile picture](${t.avatarUrl})
`),{content:[{type:"text",text:o}]}}catch(t){return {content:[{type:"text",text:`Error fetching user profile: ${t}`}],isError:true}}});}function Xe(r,e){Be(r,e),ze(r,e),Ge(r,e),qe(r,e),Je(r,e),Ke(r,e),Ve(r,e),Ze(r,e);}function et(r,e){r.command("mcp").description("Start an MCP server with search and status capabilities").action(async()=>{e.hasWorkspace||(console.error("Error: Workspace must be specified with --workspace or --last-workspace"),console.error("Example: slack-tools mcp --workspace your-workspace"),process.exit(1));let s=process.env.npm_package_version||"1.0.2",t=new McpServer({name:"slack-tools-server",version:s});Xe(t,e);let o=new StdioServerTransport;await t.connect(o);});}function tt(r,e){r.command("create-reminder <text>").description("Create a new Slack reminder").option("-t, --time <time>",'When to remind (unix timestamp, ISO datetime, or relative time like "in 5 minutes")',"in 30 minutes").option("-u, --user <user>","User ID to create reminder for (defaults to current user)").action(async(s,t)=>{try{console.log(`Creating reminder: "${s}" at ${t.time}`),t.user&&console.log(`For user: ${t.user}`);let o=await F(s,t.time,e,t.user);if(o.success){if(console.log("\u2705 Reminder created successfully!"),o.reminder){let n=new Date(parseInt((o.reminder.time||0).toString())*1e3).toLocaleString();console.log(`Text: ${o.reminder.text}`),console.log(`Time: ${n}`);}}else console.log("\u274C Failed to create reminder");}catch(o){console.error("Error:",o),process.exit(1);}});}function rt(r,e){r.command("thread <channel> <timestamp>").description("Get replies in a Slack thread").option("-l, --limit <number>","Maximum number of replies to fetch","20").action(async(s,t,o)=>{try{let n=parseInt(o.limit,10);console.log(`Fetching replies for thread in channel ${s} at timestamp ${t}`),console.log(`Limit: ${n} replies`);let a=await W(s,t,e,n);if(a.replies.length===0){console.log("No replies found in this thread.");return}console.log(`Found ${a.replies.length} replies:
`),a.replies.forEach((i,c)=>{let m=i.user||"unknown",u=m&&a.users[m]?a.users[m].displayName:m,l=i.ts?new Date(parseInt(i.ts)*1e3).toLocaleString():"unknown time";console.log(`Reply #${c+1}:`),console.log(`From: ${u}`),console.log(`Time: ${l}`),console.log(`Text: ${i.text||""}`),console.log();});}catch(n){console.error("Error:",n),process.exit(1);}});}function ot(r,e){r.command("activity").description("Get activity statistics for a Slack user across channels").option("-u, --user <user-id>","User ID to analyze (defaults to current user)").option("-c, --count <number>","Number of messages to analyze","100").action(async s=>{try{let t=parseInt(s.count,10);console.log("Analyzing user activity..."),s.user?console.log(`User: ${s.user}`):console.log("User: current user"),console.log(`Analyzing ${t} most recent messages`);let o=await O(t,e,s.user);if(console.log(`
-------------------------------------`),console.log(`User Activity Summary for ${o.userId}`),console.log("-------------------------------------"),console.log(`Total Messages: ${o.totalMessages}`),console.log(`Time Period: ${o.timePeriod}`),console.log(`
Channel Breakdown:`),console.log("-------------------------------------"),o.channelBreakdown.length===0)console.log("No channel activity found.");else {let n=Math.max(...o.channelBreakdown.map(a=>a.channelName.length),15);console.log("Channel".padEnd(n),"Messages".padStart(10),"Percentage".padStart(12)),console.log("-".repeat(n+24)),o.channelBreakdown.forEach(a=>{let i=(a.messageCount/o.totalMessages*100).toFixed(1);console.log(a.channelName.padEnd(n),a.messageCount.toString().padStart(10),`${i}%`.padStart(12));});}console.log("-------------------------------------");}catch(t){console.error("Error:",t),process.exit(1);}});}function st(r,e){me(r),ye(r,e),Ne(r,e),Ae(r,e),Pe(r,e),je(r,e),et(r,e),tt(r,e),rt(r,e),ot(r,e);}var H=class{_workspace;_lastWorkspaceUsed=false;_debug=false;set workspace(e){this._workspace=e;}get workspace(){return this._workspace||(console.error("Error: No workspace specified. Please specify a workspace using:"),console.error("  - Use -w, --workspace <workspace> to specify a workspace directly"),console.error("  - Use -l, --last-workspace to use your most recently used workspace"),process.exit(1)),this._workspace}get hasWorkspace(){return !!this._workspace}set lastWorkspaceUsed(e){this._lastWorkspaceUsed=e;}get lastWorkspaceUsed(){return this._lastWorkspaceUsed}set debug(e){this._debug=e;}get debug(){return this._debug}debugLog(e,...s){this._debug&&(s.length>0?console.error("[DEBUG]",e,...s):console.error("[DEBUG]",e));}};var Yt=fileURLToPath(import.meta.url),zt=dirname(Yt),Gt=JSON.parse(readFileSync(join(zt,"../package.json"),"utf8")),K=new Command;K.name("slack-tools").description("CLI for extracting Slack tokens and cookies and making API calls").version(Gt.version).option("-w, --workspace <workspace>","Specify Slack workspace URL or name").option("-l, --last-workspace","Use the last used workspace").option("-d, --debug","Enable debug mode for detailed logging");var C=new H;st(K,C);K.hook("preAction",async r=>{let e=r.opts();if(e.debug&&(C.debug=true,C.debugLog("Debug mode enabled")),e.workspace)C.workspace=e.workspace,C.debugLog(`Using workspace: ${e.workspace}`),await Ee(e.workspace);else if(e.lastWorkspace){let s=await ve();s?(C.workspace=s,C.lastWorkspaceUsed=true,C.debugLog(`Using last workspace: ${s}`)):(console.error("No last workspace found. Please specify a workspace using --workspace."),C.debugLog("No last workspace found in cache"));}});K.parse(process.argv);//# sourceMappingURL=cli.mjs.map
//# sourceMappingURL=cli.mjs.map